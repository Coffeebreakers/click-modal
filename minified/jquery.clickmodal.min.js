(function(a){a.fn.modal=function(b){if(!b){if(this.attr("href")){b={url:this.attr("href")}}}else{if(!b.url){if(this.attr("href")){b.url=this.attr("href")}}}var d={url:"#",backgroundColor:"#000",backgroundOpacity:0.5,position:"center",referencePosition:this,top:0,left:0,closeEsc:true,closeClickOut:false,autoOpen:false};b=jQuery.extend(d,b);function c(){a("body").append(a("<img />").attr({src:"img/load.gif",width:88,height:78,alt:"",className:"load"})).append(a("<div></div>").addClass("bg_modal")).append(a("<div></div>").addClass("view_modal"));var i=a("html")[0].scrollHeight<a(window).height()?a(window).height():a("html")[0].scrollHeight;a(".bg_modal").width(a("html")[0].scrollWidth).height(i);if(b.backgroundOpacity!==0){a(".bg_modal").css("background-color",b.backgroundColor);a(".view_modal").css("opacity",0);a(".bg_modal").css("opacity",0)}a("select").css("visibility","hidden");if(b.position==="relative"){var h=b.referencePosition.offset(),g=h.left,f=h.top}a(".bg_modal").fadeTo("fast",b.backgroundOpacity,function(){a(".view_modal").load(b.url,{nocacheattr:(new Date()).getTime()},function(){a(".load").remove();var j=function(){var l;if(this.pageYOffset){l=this.pageYOffset}else{if(document.documentElement&&document.documentElement.scrollTop||document.documentElement.scrollLeft){l=document.documentElement.scrollTop}else{if(document.body){l=document.body.scrollTop}}}return l};if(b.position!=="center"){var k=parseInt(b.top,10)+parseInt(f,10)+parseInt(a(".view_modal").height(),10);if(i<k){b.top=0;f=i-parseInt(a(".view_modal").height(),10)}a(".view_modal").css({marginTop:f,marginLeft:g,left:b.left,top:b.top})}else{a(".view_modal").css({marginTop:parseInt(new j()-(a(".view_modal").height()/2),10),marginLeft:-parseInt(a(".view_modal").width()/2,10)})}if(b.backgroundOpacity!==0){a(".view_modal").fadeTo("fast",1)}a("a[rel='modalclose']").click(function(){e();return false})})});if(b.closeClickOut===true){a(".bg_modal").click(function(){e()})}if(b.closeEsc===true){a(window).keydown(function(j){if(j.keyCode===27){e()}})}else{return false}if(b.autoOpen===false){this.click(c)}else{c()}function e(){a(".view_modal").fadeTo("fast",0,function(){a(this).remove()});a(".bg_modal").fadeTo("fast",0,function(){a(this).remove();a("select").css("visibility","visible")});a(window).unbind();a(".bg_modal").unbind()}this.css("visibility","visible")}}})(jQuery);